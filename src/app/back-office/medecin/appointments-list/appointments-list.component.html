<div class="appointment-container" *ngIf="canViewListAppointment">
  <div class="header-section">
    <div class="date-display">
      @if(appointments2?.newDate != null){
        <h2>Liste des RDV pour le {{ appointments2?.newDate | date:'fullDate':'':'fr'}}</h2>
      } @else {
        <h2>Liste des RDV pour le {{ appointments2?.date | date:'fullDate':'':'fr'}}</h2>
      }
    </div>
    <button *ngIf="canGiveRightToSecretaire" 
            nz-button 
            nzType="primary" 
            (click)="showModal()" 
            class="auth-button">
      Donner des autorisations au service Sécretariat
    </button>
  </div>

  <!-- Modal -->
  <nz-modal [(nzVisible)]="isVisible"
            nzTitle="Donner de Droit à un sécretaire"
            (nzOnCancel)="handleCancel()"
            (nzOnOk)="handleOk()"
            [nzWidth]="800">
    <ng-container *nzModalContent>
      <div class="modal-content">
        <form [formGroup]="secretaryForm" class="secretary-form">
          <div class="select-wrapper">
            <label nz-form-label>Secrétaire</label>
            <nz-form-control>
              <nz-select formControlName="secretary" nzPlaceHolder="Sélectionner un secrétaire">
                <nz-option *ngFor="let secretary of secretaries" 
                          [nzValue]="secretary.id" 
                          [nzLabel]="secretary.firstName + ' ' + secretary.lastName">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </div>
        </form>
        
        <div class="divider"></div>
        
        <div class="authorities-section">
          <div *ngFor="let autority of autorities" class="authority-item">
            <div *ngIf="autority.name == 'CONFIRM'" class="auth-button-wrapper">
              <label>Confirmé</label>
              <button nz-button nzType="primary" class="confirm-btn" (click)="allow(autority)">Autoriser</button>
            </div>
            <div *ngIf="autority.name == 'POSTPONE'" class="auth-button-wrapper">
              <label>Reporté</label>
              <button nz-button class="postpone-btn" (click)="allow(autority)">Autoriser</button>
            </div>
            <div *ngIf="autority.name == 'CANCEL'" class="auth-button-wrapper">
              <label>Annulé</label>
              <button nz-button class="cancel-btn" (click)="allow(autority)">Autoriser</button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </nz-modal>

  <div class="filter-buttons">
    <button nz-button nzType="primary" (click)="filterAppointment('ASKED')">Demandés</button>
    <button nz-button nzType="primary" (click)="filterAppointment('CONFIRMED')">Confirmés</button>
    <button nz-button nzType="primary" (click)="filterAppointment('POSTPONE')">Reportés</button>
    <button nz-button nzType="primary" (click)="filterAppointment('CANCEL')">Annulés</button>
    <button nz-button nzType="primary" (click)="loadAvailabilityAndAppiontment()">Tous les rendez-vous</button>
  </div>

  <div class="table-responsive">
    <nz-table [nzData]="appointments">
      <thead>
        <tr>
          <th>#</th>
          <th>Nom</th>
          <th>Prenom</th>
          <th>Email</th>
          <th>Téléphone</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let appointment of appointments; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ appointment.patientLastName }}</td>
          <td>{{ appointment.patientFirstName }}</td>
          <td>{{ appointment.patientEmail }}</td>
          <td>{{ appointment.patientPhone }}</td>
          <td>{{ appointment.newDate | date: 'd MMMM y':'':'fr'}}</td>
          <td>
            <span [ngClass]="'status-' + appointment.status.toLowerCase()">
              {{ 
                appointment.status === 'ASKED' ? 'En attente' :
                appointment.status === 'POSTPONE' ? 'Reporté' :
                appointment.status === 'CONFIRMED' ? 'Confirmé' :
                appointment.status === 'CANCEL' ? 'Annulé' : ''
              }}
            </span>
          </td>
          <td class="action-buttons">
            <div class="button-group">
              <button nz-button class="confirm-btn" 
                      *ngIf="appointment.status === 'ASKED' || appointment.status === 'POSTPONE'"
                      (click)="showConfirmationDialog(appointment)">Confirmer</button>
              <button nz-button class="postpone-btn"
                      *ngIf="appointment.status === 'ASKED' || appointment.status === 'POSTPONE'"
                      (click)="showpostponeDialog(appointment)">Reporter</button>
              <button nz-button class="cancel-btn"
                      *ngIf="appointment.status === 'ASKED' || appointment.status === 'POSTPONE'"
                      (click)="showdeleteDialog(appointment)">Annuler</button>
              <button nz-button class="follow-btn"
                      *ngIf="appointment.status === 'CONFIRMED'"
                      (click)="followAppointment(appointment)">Suivi</button>
            </div>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
</div>